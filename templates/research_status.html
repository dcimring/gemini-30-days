<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Research Status</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=IM+Fell+English+SC&display=swap');

        body {
            font-family: 'IM Fell English SC', serif;
            background-color: #2e2722;
            color: #dcbfa5;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            background-image: repeating-linear-gradient(45deg, #3b322c 0, #3b322c 1px, #2e2722 0, #2e2722 50%);
            background-size: 20px 20px;
        }

        .container {
            background-color: #dcbfa5;
            color: #3e2723;
            padding: 3rem;
            border-radius: 4px;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
            max-width: 800px;
            width: 100%;
            border: 2px solid #5d4037;
        }

        h1 {
            font-family: 'Cinzel Decorative', cursive;
            text-align: center;
            margin-bottom: 2rem;
            border-bottom: 2px dashed #5d4037;
            padding-bottom: 10px;
        }

        .status-box {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.3);
            border: 1px solid #a1887f;
        }

        .spinner {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #5d4037;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 2s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result-content {
            white-space: pre-wrap;
            line-height: 1.6;
            font-size: 1.2rem;
            display: none; /* Hidden initially */
            padding: 20px;
            background: rgba(255,255,255,0.5);
            border-radius: 4px;
            border: 1px solid #8d6e63;
        }

        .back-link {
            display: block;
            margin-top: 20px;
            color: #b71c1c;
            text-decoration: none;
            font-weight: bold;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Researching: {{ topic }}</h1>
        
        <div class="status-box">
            <h2 id="status-text">Status: Pending...</h2>
            <div id="spinner" class="spinner"></div>
            <p>Task ID: {{ task_id }}</p>
        </div>

        <div id="result-area" class="result-content">
            <!-- Essay content goes here -->
        </div>

        <a href="/research" class="back-link">‚Üê Start New Research</a>
    </div>

    <script>
        const taskId = "{{ task_id }}";
        const statusText = document.getElementById('status-text');
        const spinner = document.getElementById('spinner');
        const resultArea = document.getElementById('result-area');

        function checkStatus() {
            fetch(`/research/status/${taskId}`)
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    if (data.state === 'SUCCESS' || data.result) {
                        statusText.textContent = "Status: Complete!";
                        spinner.style.display = 'none';
                        resultArea.style.display = 'block';
                        resultArea.textContent = data.result;
                    } else if (data.state === 'FAILURE') {
                        statusText.textContent = "Status: Failed!";
                        spinner.style.display = 'none';
                        resultArea.style.display = 'block';
                        resultArea.textContent = "Error: " + data.status;
                    } else {
                        // Still pending
                        setTimeout(checkStatus, 2000);
                    }
                })
                .catch(err => {
                    console.error("Error polling:", err);
                    statusText.textContent = "Status: Error checking status";
                });
        }

        // Start polling
        checkStatus();
    </script>
</body>
</html>
